import json

import requests


def requests_web_data(url):
    try:
        headers = {"User-Agent": "", "Cookie": ""}
        r = requests.get(url, headers=headers)
        r.raise_for_status()
        r.encoding = r.apparent_encoding
    except:
        print('requests error!')
    else:
        return r.content

def get_weibo_historical_data():
    latest_time_id_url = 'https://www.eecso.com/test/weibo/apis/getlatest.php'
    latest_time_id = json.loads(requests_web_data(latest_time_id_url).decode('utf-8'))[0]
    # 筛选获取time_id
    time_ids = []
    for x in range(48438, int(latest_time_id) + 1, 180):    # time_id=48438：2020-01-01
        time_id_url = 'https://www.eecso.com/test/weibo/apis/getlatest.php?timeid=' + str(x)
        time_data = json.loads(requests_web_data(time_id_url).decode('utf-8'))
        if time_data is not None:
            time = time_data[1].split(' ')[1].split(':')[0]
            if time == '00' or time == '12':
                time_ids.append(time_data[0])
    if time_ids[-1] != latest_time_id:
        time_ids.append(latest_time_id)
    return time_ids

time_ids =['48438', '48798', '49158', '49518', '49878', '50238', '50598', '50958', '51318', '51678', '52038', '52398', '52758', '53118', '53478', '53838', '54198', '54558', '54918', '55278', '55638', '55998', '56358', '56718', '57078', '57438', '57798', '58158', '58518', '58878', '59238', '59598', '59958', '60318', '60678', '61038', '61398', '61758', '62118', '62478', '62838', '63198', '63558', '63918', '64278', '64638', '64998', '65358', '65718', '66078', '66438', '66798', '67158', '67518', '67878', '68238', '68598', '68958', '69318', '69678', '70038', '70398', '70758', '71118', '71478', '71838', '72198', '72558', '72918', '73278', '73638', '73998', '74358', '74718', '75078', '75438', '75798', '76158', '76518', '76878', '77238', '77598', '77958', '78318', '78678', '79038', '79398', '79758', '80118', '80478', '80838', '81198', '81558', '81918', '82278', '82638', '82998', '83358', '83718', '84078', '84438', '84798', '85158', '85518', '85878', '86238', '86598', '86958', '87318', '87678', '88038', '88398', '88758', '89118', '89478', '89838', '90198', '90558', '90918', '91278', '91638', '91998', '92358', '92718', '93078', '93438', '93798', '94158', '94518', '94878', '95238', '95598', '95958', '96318', '96678', '97038', '97398', '97758', '98118', '98478', '98838', '99198', '99558', '99918', '100278', '100638', '100998', '101358', '101718', '102078', '102438', '102798', '103158', '103518', '103878', '104238', '104598', '104958', '105318', '105678', '106038', '106398', '106758', '107118', '107478', '107838', '108198', '108558', '108918', '109278', '109638', '109998', '110358', '110718', '111078', '111438', '111798', '112158', '112518', '112878', '113238', '113598', '113958', '114318', '114678', '115038', '115398', '115758', '116118', '116478', '116838', '117198', '117558', '117918', '118278', '118638', '118998', '119358', '119718', '120078', '120438', '120798', '121158', '121518', '121878', '122238', '122598', '122958', '123318', '123678', '124038', '124398', '124758', '125118', '125478', '125838', '126198', '126558', '126918', '127278', '127638', '127998', '128358', '128718', '129078', '129438', '129798', '130158', '130518', '130878', '131238', '131598', '131958', '132318', '132678', '133038', '133398', '133758', '134118', '134478', '134838', '135198', '135558', '135918', '136278', '136638', '136998', '137358', '137718', '138078', '138438', '138798', '139158', '139518', '139878', '140238', '140598', '140958', '141318', '141678', '142038', '142398', '142758', '143118', '143478', '143838', '144198', '144558', '144918', '145278', '145638', '145998', '146358', '146718', '147078', '147438', '147798', '148158', '148518', '148878', '149238', '149598', '149958', '150318', '150678', '151038', '151398', '151758', '152118', '152478', '152838', '153198', '153558', '153918', '154278', '154638', '154774']


print(get_weibo_historical_data())